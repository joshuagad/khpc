apiVersion: v1
kind: ConfigMap
metadata:
  name: etc-sysconfig
  namespace: hpc
data:
  sackd: |
    SACKD_OPTIONS="--conf-server slurmctl"
  slurmd: |
    SLURMD_OPTIONS="--conf-server slurmctl"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: slurm-key
  namespace: hpc
data:
  slurm.key: |
    slurm_pgcv.hpc_2025-01-21
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: etc-slurm
  namespace: hpc
data:
  slurmdbd.conf: |
    AllowNoDefAcct=yes
    AuthInfo=use_client_ids
    AuthType=auth/slurm
    DbdHost=slurmdb-0
    SlurmUser=root
    StorageType=accounting_storage/mysql
    StorageHost=127.0.0.1
    StoragePort=3306
    StorageUser=slurm
    StoragePass=slurm1234
    StorageLoc=slurm_acct_db
  slurm.conf: |
    # slurm.conf file generated by configurator.html.
    # Put this file on all nodes of your cluster.
    # See the slurm.conf man page for more information.
    #
    ClusterName=pgcv
    SlurmctldHost=slurmctl-0(slurmctl)
    AuthType=auth/slurm
    AuthInfo=use_client_ids
    CredType=cred/slurm
    #DisableRootJobs=NO
    #EnforcePartLimits=NO
    #Epilog=
    #EpilogSlurmctld=
    #FirstJobId=1
    #MaxJobId=67043328
    #GresTypes=
    #GroupUpdateForce=0
    #GroupUpdateTime=600
    #JobFileAppend=0
    #JobRequeue=1
    #JobSubmitPlugins=lua
    #KillOnBadExit=0
    #LaunchType=launch/slurm
    #Licenses=foo*4,bar
    #MailProg=/bin/mail
    #MaxJobCount=10000
    #MaxStepCount=40000
    #MaxTasksPerNode=512
    #MpiDefault=
    #MpiParams=ports=#-#
    #PluginDir=
    #PlugStackConfig=
    #PrivateData=jobs
    ProctrackType=proctrack/cgroup
    #Prolog=
    #PrologFlags=
    #PrologSlurmctld=
    #PropagatePrioProcess=0
    #PropagateResourceLimits=
    #PropagateResourceLimitsExcept=
    #RebootProgram=
    ReturnToService=1
    SlurmctldPidFile=/var/run/slurmctld.pid
    SlurmctldPort=6817
    SlurmdPidFile=/var/run/slurmd.pid
    SlurmdPort=6818
    SlurmdSpoolDir=/var/spool/slurmd
    SlurmUser=root
    #SlurmdUser=root
    #SrunEpilog=
    #SrunProlog=
    StateSaveLocation=/var/spool/slurmctld
    #SwitchType=
    #TaskEpilog=
    TaskPlugin=task/affinity,task/cgroup
    #TaskProlog=
    #TopologyPlugin=topology/tree
    #TmpFS=/tmp
    #TrackWCKey=no
    #TreeWidth=
    #UnkillableStepProgram=
    #UsePAM=0
    #
    #
    # TIMERS
    #BatchStartTimeout=10
    #CompleteWait=0
    #EpilogMsgTime=2000
    #GetEnvTimeout=2
    #HealthCheckInterval=0
    #HealthCheckProgram=
    InactiveLimit=0
    KillWait=30
    #MessageTimeout=10
    #ResvOverRun=0
    MinJobAge=300
    #OverTimeLimit=0
    SlurmctldTimeout=120
    SlurmdTimeout=300
    #UnkillableStepTimeout=60
    #VSizeFactor=0
    Waittime=0
    #
    #
    # SCHEDULING
    #DefMemPerCPU=0
    #MaxMemPerCPU=0
    #SchedulerTimeSlice=30
    SchedulerType=sched/backfill
    SelectType=select/cons_tres
    #
    #
    # JOB PRIORITY
    #PriorityFlags=
    #PriorityType=priority/multifactor
    #PriorityDecayHalfLife=
    #PriorityCalcPeriod=
    #PriorityFavorSmall=
    #PriorityMaxAge=
    #PriorityUsageResetPeriod=
    #PriorityWeightAge=
    #PriorityWeightFairshare=
    #PriorityWeightJobSize=
    #PriorityWeightPartition=
    #PriorityWeightQOS=
    #
    #
    # LOGGING AND ACCOUNTING
    #AccountingStorageEnforce=0
    AccountingStorageHost=slurmdb
    #AccountingStoragePass=
    #AccountingStoragePort=
    AccountingStorageType=accounting_storage/slurmdbd
    #AccountingStorageUser=
    #AccountingStoreFlags=
    #JobCompHost=
    #JobCompLoc=
    #JobCompParams=
    #JobCompPass=
    #JobCompPort=
    JobCompType=jobcomp/none
    #JobCompUser=
    #JobContainerType=
    JobAcctGatherFrequency=30
    #JobAcctGatherType=
    SlurmctldParameters=enable_configless
    SlurmctldDebug=info
    SlurmctldLogFile=/var/log/slurmctld.log
    SlurmdDebug=info
    SlurmdLogFile=/var/log/slurmd.log
    #SlurmSchedLogFile=
    #SlurmSchedLogLevel=
    #DebugFlags=
    #
    #
    # POWER SAVE SUPPORT FOR IDLE NODES (optional)
    #SuspendProgram=
    #ResumeProgram=
    #SuspendTimeout=
    #ResumeTimeout=
    #ResumeRate=
    #SuspendExcNodes=
    #SuspendExcParts=
    #SuspendRate=
    #SuspendTime=
    #
    #
    # COMPUTE NODES
    NodeName=cn[1-4] NodeHostname=cn[1-4] NodeAddr=cn[1-4].slurmd.hpc.svc.cluster.local CPUs=48 Boards=1 SocketsPerBoard=2 CoresPerSocket=12 ThreadsPerCore=2 State=UNKNOWN
    #NodeName=cn1 NodeHostname=cn1 NodeAddr=cn1.slurmd CPUs=48 Boards=1 SocketsPerBoard=2 CoresPerSocket=12 ThreadsPerCore=2 State=UNKNOWN
    #NodeName=cn2 NodeHostname=cn2 NodeAddr=cn2.slurmd CPUs=48 Boards=1 SocketsPerBoard=2 CoresPerSocket=12 ThreadsPerCore=2 State=UNKNOWN
    #NodeName=cn3 NodeHostname=cn3 NodeAddr=cn3.slurmd CPUs=48 Boards=1 SocketsPerBoard=2 CoresPerSocket=12 ThreadsPerCore=2 State=UNKNOWN
    #NodeName=cn4 NodeHostname=cn4 NodeAddr=cn4.slurmd CPUs=48 Boards=1 SocketsPerBoard=2 CoresPerSocket=12 ThreadsPerCore=2 State=UNKNOWN
    PartitionName=batch Nodes=cn[1-4] Default=YES MaxTime=INFINITE State=UP

